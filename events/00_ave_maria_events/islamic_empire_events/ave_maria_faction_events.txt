########################################################################################
#                                         											   #
# AVE MARIA events																	   #
# A Very Extensive Modification for Appropriate Realism and Improved Authenticity	   #
#                                         											   #
# FACTIONS EVENTS																		   #
#                               													   #
########################################################################################

# Written by Atreides

namespace = ave_maria_factions_events

# ave_maria_factions_events


# TABLE OF CONTENT:

ave_maria_factions_events.0001 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				scope:islamic_empire_influential_ruler = {
					has_government = islamic_empire_regiment_government
				}
			}
			scope:islamic_empire_influential_ruler.liege = {
				trigger_event = ave_maria_factions_events.0002
			}
			## random chance to trigger several types of demand
			## desires higher pay - will increase their salary
			# reduced chance if already asked for it, or salary is above a certain level
			## desires one time cash - one time cash injection
			## specific council position over their other internal factions
			# reduced chance if already asked for some
		}
		if = {
			limit = {
				scope:islamic_empire_influential_ruler = {
					has_government = islamic_empire_diwan_government
				}
			}
			scope:islamic_empire_influential_ruler.liege = {
				trigger_event = ave_maria_factions_events.0003
			}
		}
	}
}

## Faction reaches 100 - military
ave_maria_factions_events.0002 = {
	type = character_event
	title = ave_maria_factions_events.0001.title
	desc = ave_maria_factions_events.0001.desc

	theme = realm
	override_background = {
		event_background = ave_maria_muslim_palace
		
	}

	left_portrait = {
		character = root
	}

	right_portrait = {
		character = scope:islamic_empire_influential_ruler
	}
	

	trigger = {
		
	}

	immediate = {
		random_vassal = {
			limit = {
				has_government = islamic_empire_regiment_government
				NOT = { this = scope:islamic_empire_influential_ruler }
				primary_title = { has_variable = islamic_empire_influence_internal_faction }
			}
			save_scope_as = potential_regiment_leader_to_promote
			
		}
		every_vassal = {
			limit = {
				primary_title = {
					has_variable = islamic_empire_privilege_position
				}
			}
			primary_title = {
				remove_variable = islamic_empire_privilege_position
			}
		}
	}

	## Okay - accept
	option = {
		name = ave_maria_factions_events.0001.OPT.A
		scope:islamic_empire_influential_ruler.primary_title = {
			set_variable = {
				name = islamic_empire_privilege_position
				value = yes
			}
		}
		every_vassal = {
			limit = {
				has_government = islamic_empire_regiment_government
				NOT = { this = scope:islamic_empire_influential_ruler }
			}
			primary_title = {
				set_variable = {
					name = islamic_empire_excluded_position
					value = yes
				}
			}
		}
		add_character_modifier = islamic_empire_faction_ascendant_army
		scope:islamic_empire_influential_ruler = {
			add_opinion = {
				target = root
				modifier = roman_administration_favoured_me
				opinion = 25
			}
		}
	}

	## No
	option = {
		name = ave_maria_factions_events.0001.OPT.B
		scope:islamic_empire_influential_ruler.primary_title = {
			change_variable = {
				name = islamic_empire_influence_internal_faction
				subtract = 10
			}
		}
		scope:islamic_empire_influential_ruler = {
			add_opinion = {
				target = root
				modifier = roman_administration_fired_me
				opinion = -25
			}
			every_courtier = {
				add_opinion = {
					target = root
					modifier = roman_administration_fired_me
					opinion = -25
				}
			}
		}
	}

	## Divide and conquer
	option = {
		name = ave_maria_factions_events.0001.OPT.C
		scope:islamic_empire_influential_ruler.primary_title = {
			change_variable = {
				name = islamic_empire_influence_internal_faction
				subtract = 10
			}
		}
		scope:potential_regiment_leader_to_promote = {
			primary_title = {
				change_variable = {
					name = islamic_empire_influence_internal_faction
					add = 10
				}
			}
			
		}
	}
}

## Faction reaches 100 - diwan
ave_maria_factions_events.0003 = {
	type = character_event
	title = ave_maria_factions_events.0001.title
	desc = ave_maria_factions_events.0001.desc

	theme = realm
	override_background = {
		event_background = ave_maria_muslim_palace
		
	}

	left_portrait = {
		character = root
	}

	right_portrait = {
		character = scope:islamic_empire_influential_ruler
	}
	

	trigger = {
		
	}

	immediate = {
		random_vassal = {
			limit = {
				has_government = islamic_empire_diwan_government
				NOT = { this = scope:islamic_empire_influential_ruler }
				primary_title = { has_variable = islamic_empire_influence_internal_faction }
			}
			save_scope_as = potential_diwan_leader_to_promote
			
		}
		every_vassal = {
			limit = {
				primary_title = {
					has_variable = islamic_empire_privilege_position
				}
			}
			primary_title = {
				remove_variable = islamic_empire_privilege_position
			}
		}
	}

	## Okay - accept
	option = {
		name = ave_maria_factions_events.0001.OPT.A
		scope:islamic_empire_influential_ruler.primary_title = {
			set_variable = {
				name = islamic_empire_privilege_position
				value = yes
			}
		}
		every_vassal = {
			limit = {
				has_government = islamic_empire_diwan_government
				NOT = { this = scope:islamic_empire_influential_ruler }
			}
			primary_title = {
				set_variable = {
					name = islamic_empire_excluded_position
					value = yes
				}
			}
		}
		add_character_modifier = islamic_empire_faction_ascendant_diwan
		scope:islamic_empire_influential_ruler = {
			add_opinion = {
				target = root
				modifier = roman_administration_favoured_me
				opinion = 25
			}
		}
	}

	## No
	option = {
		name = ave_maria_factions_events.0001.OPT.B
		scope:islamic_empire_influential_ruler.primary_title = {
			change_variable = {
				name = islamic_empire_influence_internal_faction
				subtract = 10
			}
		}
		scope:islamic_empire_influential_ruler = {
			add_opinion = {
				target = root
				modifier = roman_administration_fired_me
				opinion = -25
			}
			every_courtier = {
				add_opinion = {
					target = root
					modifier = roman_administration_fired_me
					opinion = -25
				}
			}
		}
	}

	## Divide and conquer
	option = {
		name = ave_maria_factions_events.0001.OPT.C
		scope:islamic_empire_influential_ruler.primary_title = {
			change_variable = {
				name = islamic_empire_influence_internal_faction
				subtract = 10
			}
		}
		scope:potential_regiment_leader_to_promote = {
			primary_title = {
				change_variable = {
					name = islamic_empire_influence_internal_faction
					add = 10
				}
			}
			
		}
	}

	after = {
		clear_saved_scope = islamic_empire_influential_ruler
		clear_saved_scope = potential_regiment_leader_to_promote
	}
}

